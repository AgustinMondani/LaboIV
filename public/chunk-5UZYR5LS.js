import{a as F}from"./chunk-YGQ4ENZ2.js";import{b as z,d as H,e as Q,f as q,g as U,h as W,r as Z,s as G,u as L}from"./chunk-VFF2UD4S.js";import{d as A}from"./chunk-AKZVERSC.js";import"./chunk-ETUTCWQS.js";import{a as B}from"./chunk-3O7R6LMN.js";import{$a as P,Ba as C,Bb as k,Cb as j,Fa as b,Ma as x,Na as _,Oa as a,Pa as i,Ta as v,Ua as w,Va as y,W as d,Wa as M,X as p,Xa as O,Ya as S,Za as s,_a as u,ab as E,bb as I,ca as h,cb as R,gb as T,hb as D,jb as N,sa as o,wa as l,zb as V}from"./chunk-OBJE3FPQ.js";import"./chunk-LJ5XHLMQ.js";import{h as g}from"./chunk-FK42CRUA.js";var K=["chatContainer"];function X(c,e){if(c&1&&(a(0,"div",7)(1,"strong"),s(2),i(),s(3),a(4,"span",8),s(5),T(6,"date"),i()()),c&2){let t=e.$implicit,n=y();_("own-message",t.user_email===n.username),o(2),u(t.user_email),o(),P(": ",t.text," "),o(2),u(D(6,5,t.created_at,"dd/MM/yyyy HH:mm"))}}var f=class c{constructor(e,t,n,r){this.supabase=e;this.router=t;this.zone=n;this.cdr=r}messages=[];messageText="";username="";messageChannel;chatContainer;ngOnInit(){this.initChat()}ngAfterViewInit(){this.scrollToBottom()}ngOnDestroy(){this.messageChannel&&this.messageChannel.unsubscribe()}initChat(){return g(this,null,function*(){this.username=yield this.supabase.getSessionUser(),yield this.loadMessages(),this.setupRealtimeSubscription()})}loadMessages(){return g(this,null,function*(){let{data:e,error:t}=yield this.supabase.client.from("messages").select("*").order("created_at",{ascending:!0});if(t){console.error("Error cargando mensajes:",t);return}this.messages=e??[],this.cdr.detectChanges(),this.scrollToBottom()})}setupRealtimeSubscription(){this.messageChannel=this.supabase.client.channel("public:messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{this.zone.run(()=>{this.messages.push(e.new),this.cdr.detectChanges(),this.scrollToBottom()})}).subscribe(e=>{e==="SUBSCRIBED"&&console.log("Suscripci\xF3n a mensajes activa")})}sendMessage(){return g(this,null,function*(){let e=this.messageText.trim();if(!e)return;if(e.length>50){alert("El mensaje no puede superar los 50 caracteres.");return}let{error:t}=yield this.supabase.client.from("messages").insert({text:e,user_email:this.username});if(t){console.error("Error enviando mensaje:",t),alert("Hubo un error al enviar el mensaje.");return}this.messageText=""})}scrollToBottom(){if(!this.chatContainer)return;let e=this.chatContainer.nativeElement;e.scrollTop=e.scrollHeight}logout(){this.supabase.logout().then(()=>this.router.navigate(["/login"])).catch(e=>console.error("Error al cerrar sesi\xF3n:",e))}backHome(){this.router.navigate(["/home"])}static \u0275fac=function(t){return new(t||c)(l(B),l(A),l(h),l(N))};static \u0275cmp=C({type:c,selectors:[["app-sala-chat"]],viewQuery:function(t,n){if(t&1&&M(K,5),t&2){let r;O(r=S())&&(n.chatContainer=r.first)}},decls:10,vars:2,consts:[["chatContainer",""],[1,"chat-container"],[1,"chat-messages"],["class","message",3,"own-message",4,"ngFor","ngForOf"],[3,"submit"],["type","text","name","message","required","","placeholder","Escrib\xED tu mensaje, maximo 50 caracteres","maxlength","50",3,"ngModelChange","ngModel"],["type","submit"],[1,"message"],[1,"timestamp"]],template:function(t,n){if(t&1){let r=v();a(0,"div",1)(1,"h2"),s(2,"Sala de Chat"),i(),a(3,"div",2,0),b(5,X,7,8,"div",3),i(),a(6,"form",4),w("submit",function(m){return d(r),n.sendMessage(),p(m.preventDefault())}),a(7,"input",5),R("ngModelChange",function(m){return d(r),I(n.messageText,m)||(n.messageText=m),p(m)}),i(),a(8,"button",6),s(9,"Enviar"),i()()()}t&2&&(o(5),x("ngForOf",n.messages),o(2),E("ngModel",n.messageText))},dependencies:[j,V,k,L,W,z,H,Q,Z,G,U,q],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;height:94vh;font-family:Segoe UI,sans-serif;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:#fff}.chat-container[_ngcontent-%COMP%]{width:50%;height:90vh;display:flex;flex-direction:column;background:#ffffff0d;border-radius:1rem;padding:2rem;box-shadow:0 0 25px #00c6ff1a}.chat-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:2rem;margin-bottom:1rem;color:#00c6ff;text-shadow:0 0 10px rgba(0,198,255,.6)}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-right:.5rem;display:flex;flex-direction:column;gap:1rem;margin-bottom:1rem}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#00c6ff66;border-radius:4px}.message[_ngcontent-%COMP%]{max-width:75%;background:#ffffff14;padding:1rem;border-radius:1rem;box-shadow:0 0 15px #0000004d;animation:fadeIn .3s ease;transition:transform .2s ease;align-self:flex-start}.own-message[_ngcontent-%COMP%]{align-self:flex-end;background:#00c6ff26;box-shadow:0 0 15px #00c6ff66;text-align:right}.message[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .own-message[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#00c6ff;display:block;margin-bottom:.3rem;text-shadow:0 0 5px rgba(0,198,255,.5)}.timestamp[_ngcontent-%COMP%]{font-size:.75rem;color:#ccc;margin-top:.5rem;font-style:italic}.own-message[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{text-align:left}form[_ngcontent-%COMP%]{display:flex;gap:1rem}input[type=text][_ngcontent-%COMP%]{flex:1;padding:.8rem 1.2rem;border-radius:1rem;border:none;outline:none;background:#ffffff1a;color:#fff;font-size:1rem;box-shadow:inset 0 0 5px #ffffff0d}input[type=text][_ngcontent-%COMP%]::placeholder{color:#ccc}button[_ngcontent-%COMP%]{padding:.8rem 1.5rem;border:none;border-radius:1rem;background:linear-gradient(145deg,#00c6ff,#0072ff);color:#fff;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 0 10px #00c6ff66}button[_ngcontent-%COMP%]:hover{background:linear-gradient(145deg,#009ee0,#05a);transform:scale(1.05)}"]})};var ge=[{path:"",component:f,canActivate:[F]}];export{ge as routes};
