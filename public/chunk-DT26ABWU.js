import{Gb as l,K as c}from"./chunk-D3IEIHLI.js";import{a as i,b as u,h as t}from"./chunk-FK42CRUA.js";var g="https://dnajbskfruaklvmnchzv.supabase.co",I="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRuYWpic2tmcnVha2x2bW5jaHp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3NzQwNTIsImV4cCI6MjA2MTM1MDA1Mn0.hCr7K9cHmcOAolpF0RHNyj0RNfMj_PA42HIkaMMR2UI",r=l(g,I);var m=class n{constructor(){}login(e,s){return t(this,null,function*(){return yield r.auth.signInWithPassword({email:e,password:s})})}register(e,s,a){return t(this,null,function*(){return yield r.auth.signUp({email:e,password:s,options:{data:{username:a}}})})}logout(){return t(this,null,function*(){return yield r.auth.signOut()})}getSession(){return t(this,null,function*(){let{data:e}=yield r.auth.getSession();return e.session})}getSessionPuntaje(){return t(this,null,function*(){let{data:e,error:s}=yield r.auth.getUser();return s||!e?.user?(console.error("No se pudo obtener el usuario",s?.message),null):e.user})}getSessionUser(){return t(this,null,function*(){let{data:e}=yield r.auth.getUser();return console.log("Usuario completo:",e.user),e.user?.user_metadata?.username||null})}get client(){return r}getUserId(){return t(this,null,function*(){let{data:e,error:s}=yield r.auth.getUser();return s||!e?.user?(console.error("No se pudo obtener el usuario",s?.message),null):e.user.id})}tieneEncuesta(){return t(this,null,function*(){let e=yield this.getUserId();if(!e)return!1;let{data:s,error:a}=yield r.from("encuestas").select("id").eq("user_id",e).single();return a&&a.code!=="PGRST116"?(console.error("Error al buscar encuesta:",a.message),!1):!!s})}guardarEncuesta(e){return t(this,null,function*(){let s=yield this.getUserId();if(!s)return"Usuario no autenticado";if(yield this.tieneEncuesta())return"Ya existe una encuesta para este usuario";let d=u(i({},e),{user_id:s}),{error:o}=yield r.from("encuestas").insert([d]);return o?o.message:null})}esAdmin(){return t(this,null,function*(){let{data:{user:e},error:s}=yield r.auth.getUser();return s||!e?!1:(console.log(e.email),e.email=="admin1@admin.com")})}obtenerEncuestas(){return t(this,null,function*(){let{data:e,error:s}=yield r.from("encuestas").select("*");return{data:e??[],error:s}})}static \u0275fac=function(s){return new(s||n)};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{m as a};
