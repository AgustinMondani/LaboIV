import{a as j}from"./chunk-LMT2AVM4.js";import{b as B,d as F,e as A,f as z,g as H,h as V,r as Q,s as q,u as U}from"./chunk-GN3DSZMQ.js";import{d as k}from"./chunk-IUAF4EHQ.js";import"./chunk-NSFHJ6NV.js";import{a as D}from"./chunk-2QAIXTRJ.js";import{$a as d,Ab as I,Ca as u,Cb as N,Db as R,Ga as h,Na as C,Oa as b,Pa as a,Qa as o,Va as x,Wa as _,Xa as v,Ya as M,Za as y,_a as i,ab as w,bb as O,cb as S,da as p,db as P,hb as E,ib as T,ta as s,xa as g}from"./chunk-4LKR36O3.js";import"./chunk-LJ5XHLMQ.js";import{h as l}from"./chunk-FK42CRUA.js";var W=["chatContainer"];function Z(r,t){if(r&1&&(a(0,"div",6)(1,"strong"),i(2),o(),i(3),a(4,"span",7),i(5),E(6,"date"),o()()),r&2){let e=t.$implicit,n=_();b("own-message",e.user_email===n.username),s(2),d(e.user_email),s(),w(": ",e.text," "),s(2),d(T(6,5,e.created_at,"dd/MM/yyyy HH:mm"))}}var f=class r{constructor(t,e,n){this.supabase=t;this.router=e;this.zone=n}messages=[];messageText="";username="";messageChannel;chatContainer;ngOnInit(){return l(this,null,function*(){this.username=yield this.supabase.getSessionUser(),this.loadMessages(),this.setupRealtimeSubscription(),this.scrollToBottom()})}ngOnDestroy(){this.messageChannel&&this.messageChannel.unsubscribe()}loadMessages(){return l(this,null,function*(){let{data:t,error:e}=yield this.supabase.client.from("messages").select("*").order("created_at",{ascending:!0});if(e){console.error("Error cargando mensajes:",e);return}this.messages=t??[],this.scrollToBottom()})}setupRealtimeSubscription(){this.messageChannel=this.supabase.client.channel("public:messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},t=>{this.zone.run(()=>{this.messages=[...this.messages,t.new],this.scrollToBottom()})}).subscribe(t=>{t==="SUBSCRIBED"&&console.log("Suscripci\xF3n a mensajes activa")})}sendMessage(){return l(this,null,function*(){let t=this.messageText.trim();if(!t)return;if(t.length>50){alert("El mensaje no puede superar los 50 caracteres.");return}let{error:e}=yield this.supabase.client.from("messages").insert({text:t,user_email:this.username});if(this.loadMessages(),e){console.error("Error enviando mensaje:",e),alert("Hubo un error al enviar el mensaje.");return}this.messageText=""})}scrollToBottom(){setTimeout(()=>{this.chatContainer?.nativeElement&&(this.chatContainer.nativeElement.scrollTop=this.chatContainer.nativeElement.scrollHeight)},100)}logout(){this.supabase.logout().then(()=>this.router.navigate(["/login"])).catch(t=>console.error("Error al cerrar sesi\xF3n:",t))}backHome(){this.router.navigate(["/home"])}static \u0275fac=function(e){return new(e||r)(g(D),g(k),g(p))};static \u0275cmp=u({type:r,selectors:[["app-sala-chat"]],viewQuery:function(e,n){if(e&1&&v(W,5),e&2){let c;M(c=y())&&(n.chatContainer=c.first)}},decls:9,vars:2,consts:[[1,"chat-container"],[1,"chat-messages"],["class","message",3,"own-message",4,"ngFor","ngForOf"],[3,"submit"],["type","text","name","message","required","","placeholder","Escrib\xED tu mensaje, maximo 50 caracteres","maxlength","50",3,"ngModelChange","ngModel"],["type","submit"],[1,"message"],[1,"timestamp"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"h2"),i(2,"Sala de Chat"),o(),a(3,"div",1),h(4,Z,7,8,"div",2),o(),a(5,"form",3),x("submit",function(m){return n.sendMessage(),m.preventDefault()}),a(6,"input",4),P("ngModelChange",function(m){return S(n.messageText,m)||(n.messageText=m),m}),o(),a(7,"button",5),i(8,"Enviar"),o()()()),e&2&&(s(4),C("ngForOf",n.messages),s(2),O("ngModel",n.messageText))},dependencies:[R,I,N,U,V,B,F,A,Q,q,H,z],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;height:94vh;font-family:Segoe UI,sans-serif;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:#fff}.chat-container[_ngcontent-%COMP%]{width:50%;height:90vh;display:flex;flex-direction:column;background:#ffffff0d;border-radius:1rem;padding:2rem;box-shadow:0 0 25px #00c6ff1a}.chat-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:2rem;margin-bottom:1rem;color:#00c6ff;text-shadow:0 0 10px rgba(0,198,255,.6)}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-right:.5rem;display:flex;flex-direction:column;gap:1rem;margin-bottom:1rem}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#00c6ff66;border-radius:4px}.message[_ngcontent-%COMP%]{max-width:75%;background:#ffffff14;padding:1rem;border-radius:1rem;box-shadow:0 0 15px #0000004d;animation:fadeIn .3s ease;transition:transform .2s ease;align-self:flex-start}.own-message[_ngcontent-%COMP%]{align-self:flex-end;background:#00c6ff26;box-shadow:0 0 15px #00c6ff66;text-align:right}.message[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .own-message[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#00c6ff;display:block;margin-bottom:.3rem;text-shadow:0 0 5px rgba(0,198,255,.5)}.timestamp[_ngcontent-%COMP%]{font-size:.75rem;color:#ccc;margin-top:.5rem;font-style:italic}.own-message[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{text-align:left}form[_ngcontent-%COMP%]{display:flex;gap:1rem}input[type=text][_ngcontent-%COMP%]{flex:1;padding:.8rem 1.2rem;border-radius:1rem;border:none;outline:none;background:#ffffff1a;color:#fff;font-size:1rem;box-shadow:inset 0 0 5px #ffffff0d}input[type=text][_ngcontent-%COMP%]::placeholder{color:#ccc}button[_ngcontent-%COMP%]{padding:.8rem 1.5rem;border:none;border-radius:1rem;background:linear-gradient(145deg,#00c6ff,#0072ff);color:#fff;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 0 10px #00c6ff66}button[_ngcontent-%COMP%]:hover{background:linear-gradient(145deg,#009ee0,#05a);transform:scale(1.05)}"]})};var ie=[{path:"",component:f,canActivate:[j]}];export{ie as routes};
